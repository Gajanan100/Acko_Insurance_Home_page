(function(){"use strict";window.wisepops===void 0&&(window.wisepops=function(){window.wisepops.q.push(arguments)},window.wisepops.q=[],window.wisepops.l=Date.now());const Ye="2.1.7",xe="https://notifications.wisepops.com",ei="https://wisepops.net",ti="https://wisepops.net",ii="https://cdn.wisepops.com",ni="https://tracking.wisepops.com",si="https://wisepops.net",Ne="https://wisepops.net",Xe="https://activity.wisepops.com",L="AgGNMkk7M8",J="mK2r",oi="67186",Ze="eyJwdXNoIjpudWxsLCJub3RpZmljYXRpb25zIjp7ImpzIjpudWxsLCJjc3MiOm51bGwsImZvbnQiOm51bGwsIndpc3BfaWNvbiI6bnVsbCwiZmVlZF90aXRsZSI6bnVsbCwiZ29vZ2xlX2ZvbnQiOm51bGwsInRpdGxlX2NvdW50IjpudWxsLCJ3aWRnZXRfdHlwZSI6bnVsbCwiYmVsbF9lbmFibGVkIjpudWxsLCJidXR0b25fY29sb3IiOm51bGwsIndpZGdldF9jb2xvciI6bnVsbCwid2lkZ2V0X2ltYWdlIjpudWxsLCJtb2JpbGVfcG9zaXRpb24iOm51bGwsIndpZGdldF9wb3NpdGlvbiI6bnVsbCwiZGVza3RvcF9wb3NpdGlvbiI6bnVsbCwid2lkZ2V0X2NvdW50X3RvcCI6bnVsbCwiYnV0dG9uX3RleHRfY29sb3IiOm51bGwsIndpZGdldF9pY29uX2NvbG9yIjpudWxsLCJob3Zlcl9idXR0b25fY29sb3IiOm51bGwsIndpZGdldF9jb3VudF9yaWdodCI6bnVsbCwid2lkZ2V0X3R5cGVfbW9iaWxlIjpudWxsLCJidXR0b25fYm9yZGVyX2NvbG9yIjpudWxsLCJtb2JpbGVfY3NzX3NlbGVjdG9yIjpudWxsLCJidXR0b25fYm9yZGVyX3JhZGl1cyI6bnVsbCwiZGVza3RvcF9jc3Nfc2VsZWN0b3IiOm51bGwsIndpZGdldF9leHRyYV9jb3VudF90b3AiOm51bGwsIndpZGdldF9wb3NpdGlvbl9tb2JpbGUiOm51bGwsIndpZGdldF92ZXJ0aWNhbF9vZmZzZXQiOm51bGwsImhvdmVyX2J1dHRvbl90ZXh0X2NvbG9yIjpudWxsLCJ3aWRnZXRfY291bnRfYmFja2dyb3VuZCI6bnVsbCwid2lkZ2V0X2NvdW50X3RleHRfY29sb3IiOm51bGwsIndpZGdldF9jb3VudF90b3BfbW9iaWxlIjpudWxsLCJ3aWRnZXRfZXh0cmFfY291bnRfcmlnaHQiOm51bGwsIndpZGdldF9ob3Jpem9udGFsX29mZnNldCI6bnVsbCwiaG92ZXJfYnV0dG9uX2JvcmRlcl9jb2xvciI6bnVsbCwid2lkZ2V0X2NvdW50X3JpZ2h0X21vYmlsZSI6bnVsbCwid2lkZ2V0X2V4dHJhX2NvdW50X2JhY2tncm91bmQiOm51bGx9fQ==",ri="BJ-6ETGowvDy0CreCX__KEarfYFnvh7LuPnEMDE99FfkGaapjWqzUwk1GNIMBidfdqQki_dL_9cDvfVPZUOnvho",Qe="CAMPAIGN_ENGINE,VISITOR_ID".split(","),ai="W3siaGFzaCI6bnVsbCwidHlwZSI6bnVsbCwidHJhY2tVcmwiOm51bGwsImF0dHJpYnV0ZVJldmVudWUiOm51bGx9XQ==";typeof sessionStorage<"u"&&sessionStorage.setItem("wisepops-version",Ye);let ce;const ci=new Uint8Array(16);function li(){if(!ce&&(ce=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ce))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ce(ci)}const b=[];for(let t=0;t<256;++t)b.push((t+256).toString(16).slice(1));function di(t,e=0){return b[t[e+0]]+b[t[e+1]]+b[t[e+2]]+b[t[e+3]]+"-"+b[t[e+4]]+b[t[e+5]]+"-"+b[t[e+6]]+b[t[e+7]]+"-"+b[t[e+8]]+b[t[e+9]]+"-"+b[t[e+10]]+b[t[e+11]]+b[t[e+12]]+b[t[e+13]]+b[t[e+14]]+b[t[e+15]]}const et={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function ui(t,e,i){if(et.randomUUID&&!e&&!t)return et.randomUUID();t=t||{};const n=t.random||(t.rng||li)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){i=i||0;for(let s=0;s<16;++s)e[i+s]=n[s];return e}return di(n)}const O="wsp_session_";let T=null;const pi=()=>{if(typeof sessionStorage>"u")return;const t=sessionStorage.getItem(O+"id"),e=sessionStorage.getItem(O+"last_seen");t===null||e!==null&&Date.now()-parseInt(e)>30*60*1e3?T={id:ui(),lastSeen:Date.now(),referrer:document.referrer,landingURL:window.location.href,isNew:!0}:T={id:t,lastSeen:Date.now(),referrer:sessionStorage.getItem(O+"referrer")??document.referrer,landingURL:sessionStorage.getItem(O+"landing_url")??window.location.href,isNew:!1},T.isNew&&(sessionStorage.setItem(O+"id",T.id),sessionStorage.setItem(O+"referrer",T.referrer),sessionStorage.setItem(O+"landing_url",T.landingURL)),sessionStorage.setItem(O+"last_seen",T.lastSeen.toString())},I={cookieMaxSizeMax:1024*3,cookieMaxSizeMin:512,cookieTTLMax:365*2,cookieTTLMin:2,loggerMaxSize:1e3,secondsInDay:24*60*60,msIn30Days:30*24*60*60*1e3,visitsMaxSize:10};var w=(t=>(t.persistent="wisepops",t.session="wisepops_session",t.properties="wisepops_props",t.visits="wisepops_visits",t.noShow="wisepops_noshow",t))(w||{});const Y=oi,tt=L,le={popup:ti,cdn:ii,tracking:ni},Re=["e","p","s"],fi=Re.concat(["c"]);function G(t){const e=document.cookie.split(";");for(const i of e){const[n,s]=i.split("=");if(n.trim()===t)return(s.charAt(0)==="{"||s.charAt(0)==="[")&&unescape?unescape(s):decodeURIComponent(s.trim())}return null}function it(t,e,i,n,s,o=I.cookieMaxSizeMax){const r=`${encodeURIComponent(t)}=${encodeURIComponent(e)}; `,a=i?`path=${i}; `:"",c=n?`domain=${n}; `:"",d="samesite=lax; ",l=s?`max-age=${s}`:"",u=r+a+c+d+l;if(u.length>o)throw new Error("Cookie is too big ("+t+")");document.cookie=u}const gi=`wisp-${xe}-${J}`,nt=`wisepops-${L}-visitor`,hi=(t,e)=>{it(t,e,"/",void 0,31536e3)},wi=()=>{var t,e,i;return((i=(e=(t=window.Shopify)==null?void 0:t.checkout)==null?void 0:e.customer_id)==null?void 0:i.toString())??null},mi=()=>{if(typeof sessionStorage>"u")return null;const t=sessionStorage.getItem(O+"id"),e=sessionStorage.getItem(O+"last_seen");return t===null||e!==null&&Date.now()-parseInt(e)>30*60*1e3?null:{id:t,referrer:sessionStorage.getItem(O+"referrer")??document.referrer,landingURL:sessionStorage.getItem(O+"landing_url")??window.location.href}},_i=()=>{if(typeof sessionStorage>"u")return null;const t=sessionStorage.getItem("wisepops_session_id");return t===null?null:{id:t,referrer:sessionStorage.getItem("wisepops_session_referrer")??document.referrer,landingURL:sessionStorage.getItem("wisepops_session_landing_url")??window.location.href}},yi=t=>{typeof sessionStorage>"u"||(sessionStorage.setItem("wisepops_session_id",t.id),sessionStorage.setItem("wisepops_session_referrer",t.referrer),sessionStorage.setItem("wisepops_session_landing_url",t.landingURL))};let x=null,$=null;const Si=async t=>{const e=G(nt)??G(gi),i=wi(),n=mi(),o=await(await fetch(`${Ne}/id?h=${L}&vid=${e??""}&eid=${i??""}&sid=${(n==null?void 0:n.id)??""}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:JSON.stringify(t)})).json();x={id:o.id,sessionId:o.session_id},hi(nt,x.id),$=_i()??n,(!$||$.id!==x.sessionId)&&($={id:x.sessionId,referrer:document.referrer,landingURL:window.location.href},yi($))};var S=(t=>(t.PAGEVIEW="PAGEVIEW",t.EXPOSURE="EXPOSURE",t.IMPRESSION="IMPRESSION",t.ENGAGEMENT="ENGAGEMENT",t.CONVERSION="CONVERSION",t))(S||{}),X=(t=>(t.POPUP="POPUP",t.NOTIFICATION="NOTIFICATION",t.PUSH="PUSH",t))(X||{});let de=new Date().getTime().toString();typeof sessionStorage<"u"&&sessionStorage.setItem("wisepops-pageview_id",de);const v=async(t,e={})=>{var s,o,r;const i={type:t};if(x!==null?(i.visitorId=x.id,i.sessionId=x.sessionId,$!==null&&(i.sessionReferrer=encodeURI($.referrer),i.landingURL=encodeURI($.landingURL))):T!==null&&(i.sessionId=T.id,i.sessionReferrer=encodeURI(T.referrer),i.landingURL=encodeURI(T.landingURL)),typeof window<"u"){t==="PAGEVIEW"&&(de=new Date().getTime().toString(),typeof sessionStorage<"u"&&sessionStorage.setItem(`wisepops-${L}-pageview_id`,de)),i.pageviewId=de,i.page=location.hostname+location.pathname,i.url=encodeURI(location.href),i.pageReferrer=encodeURI(document.referrer);const a=(r=(o=(s=window.ShopifyAnalytics)==null?void 0:s.meta)==null?void 0:o.product)==null?void 0:r.id;a&&(i.productId=a),i.tz=Intl.DateTimeFormat().resolvedOptions().timeZone,i.scrollY=window.scrollY,i.scrollYMax=Math.max(document.documentElement.scrollHeight,document.documentElement.offsetHeight)-window.innerHeight}if(i.payload=JSON.stringify(e),Xe.length===0){console.log(`Track ${t}`,i);return}const n=`${Xe}?v=${Ye}&site=${L}`;await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i),mode:"cors",credentials:"omit",cache:"no-store",redirect:"error"})};var vi="exposure",bi="impression",st="engagement";function Ii(){pe("before-tab-display",ue.bind(this,vi)),pe("before-popup-display",ue.bind(this,bi)),pe("after-tracked-click",ue.bind(this,st)),pe("after-form-submit",ue.bind(this,st))}function ue(t,e){if(!(typeof e!="object"||typeof e.detail!="object")){var i={channel:"POPUP",event:e.type};for(var n in e.detail)Object.prototype.hasOwnProperty.call(e.detail,n)&&(i[n]=e.detail[n]);if(e.target.elements&&e.target.elements.length>0){i.elements=[];for(var s=0;s<e.target.elements.length;s++){var o=e.target.elements[s];o.name&&o.value&&i.elements.push(o.name)}}return e.detail.popup&&(e.detail.popup.campaignId?i.campaignId="wisepops_c_"+e.detail.popup.campaignId:e.detail.popup.id&&(i.campaignId="wisepops_w_"+e.detail.popup.id)),v(t,i)}}function pe(t,e,i){typeof i!="object"&&(i={}),i.passive===void 0&&(i.passive=!0),window[window.wisepops_key]("listen",t,e,void 0,i)}function ot(t,e=window.location.hostname){let i=t;if(t){const n=e.match(/[a-z0-9][a-z0-9\-]+\.[a-z.]{2,6}$/i);n&&n[0]?e=n[0]:i=!1}return{hostname:e,subDomainSkipped:i}}function rt(t,e=window.location.search.substr(1)){return new URLSearchParams(e).get(t)}function Ei(t,e,i){const n=i?window.sessionStorage:window.localStorage;return n?(n.setItem(t,e),!0):!1}function Pi(t){window.localStorage&&window.localStorage.removeItem(t),window.sessionStorage&&window.sessionStorage.removeItem(t)}function at(t){const e=t===w.session?window.sessionStorage:window.localStorage;return e?e.getItem(t):null}var p=(t=>(t.none="none",t.error="error",t.warn="warn",t.info="info",t.debug="debug",t.trace="trace",t))(p||{});const Ae=["none","error","warn","info","debug","trace"],Le=class Qt{constructor(){this.displayLevel=null,this.logs=[]}static getInstance(){return Qt.instance}log(e,i,n){const s=e in p?e:"info",o={level:Ae.indexOf(s),msg:i,prop:n};this.logs.length<I.loggerMaxSize&&this.logs.push(o),this.display(o)}displayAll(e="info"){this.displayLevel=e in p?e:"info",this.logs.forEach(this.display.bind(this))}display(e){if(this.displayLevel!==null){const i=Ae.indexOf(this.displayLevel),n=window.console[Ae[e.level]];if(e.level<=i&&n){const s="WisePops - "+e.msg;e.prop?n(s,e.prop):n(s)}}}};Le.instance=new Le;let U=Le;function ct(t){return Object.keys(t).map(e=>t[e]).filter(e=>typeof e=="string")}function ki(t){if(typeof t!="string")throw new Error("Device has not been detected yet");return t.indexOf("phone_")===0}function Oi(t){if(typeof t!="string")throw new Error("Device has not been detected yet");return t.indexOf("tablet_")===0}function lt(t,e="",i={}){for(const n in t)if(t.hasOwnProperty(n)){const s=e?e+"."+n:n;t[n]instanceof Object?lt(t[n],s,i):i[s]=t[n]}return i}function Ti(t){let e=new Date(t);if(e.toString()!=="Invalid Date"||(e=new Date(parseInt(t,10)),e.toString()!=="Invalid Date"))return e}const q=U.getInstance();var dt=(t=>(t.source="source",t.medium="medium",t.campaign="campaign",t.term="term",t.content="content",t.gclid="gclid",t))(dt||{}),$e=(t=>(t.step="s",t.formSession="i",t.uniqueCoupon="c",t))($e||{});const ut=class C{constructor(){this.persistentData={csd:1,popups:{},sub:0,ucrn:null,cid:null,v:C.STORAGE_VERSION,bandit:{recos:{}}},this.sessionData={arrivalOnSite:null,mtime:null,pageviews:0,popups:{},bars:{},sticky:{},countdowns:{},src:null,utm:{},testIp:null},this.customProperties={},this.temporaryCustomProperties={},this.visits=[],this.noShow=null,this.browserStorageUsed=!1,this.arrivalOnPage=null,this.device=null,this.trafficChannel=null,this.location={country:null,region:null,city:null},this.ip="",this.cookies={ttl:I.cookieTTLMax,maxSize:I.cookieMaxSizeMax},this.banditEventIds={},this.banditIds={},this.getCookie=G,this.autoPageview=!0,this.initBrowserStorageUsed(),this.initStored(),this.initSession(),this.initCustomProperties(),this.initVisits(),this.initNoShow(),this.initExternalSubscribed(),this.migrateCookieFormat()}static isSessionCookieRecent(e,i){const n=e&&e.getTime();return(n?i-n:0)<2*60*60*1e3}static getInstance(){return C.instance||(C.instance=new C),C.instance}static isNoShowDateReached(e,i){return e.getTime()<i}initStored(){let e=this.getStorage(w.persistent);if(e)try{const i=JSON.parse(e);i.cid&&i.cid!==Y&&q.log(p.error,"Conflict between accounts: "+i.cid+"/"+Y),i.cid=Y,i.v||(i.v=0),this.persistentData={...this.persistentData,...i}}catch{q.log(p.error,"Cookie format corrupted"),e=null}e||(this.persistentData.cid=Y,this.generateUcrn()),this.saveStored(),!this.isBrowserStorageUsed()&&!this.getCookie(w.persistent)&&this.getCrossSubDomain()&&(this.setCrossSubDomain(!1),this.initStored())}isBrowserStorageUsed(e){return e?!!at(w.persistent):this.browserStorageUsed}setBrowserStorageUsed(e,i){const n=e!==this.browserStorageUsed;if(n&&i){if(!this.testStorage())throw new Error("Storage engine not available");this.removeStorage(w.persistent),this.removeStorage(w.session),this.removeStorage(w.properties),this.removeStorage(w.visits),this.removeStorage(w.noShow)}return this.browserStorageUsed=e,n&&i&&this.save(),n}setCookiesMaxSize(e){this.cookies.maxSize=e,this.save()}setCookiesTTL(e){this.cookies.ttl=e,this.save()}setAutoPageView(e){this.autoPageview=e}getAutoPageView(){return this.autoPageview}setRecaptchaSiteKey(e){this.recaptchaSiteKey=e}getRecaptchaSiteKey(){return this.recaptchaSiteKey}getPopupIds(){return Object.keys(this.persistentData.popups).map(e=>parseInt(e,10))}getSessionPopups(){return this.sessionData.popups}getSessionBars(){return this.sessionData.bars}getSessionStickyTabs(){return Object.keys(this.sessionData.sticky)}setTimerStarted(e){const i=this.getTimerStartedAt(e);if(i)return i;const n=new Date;return this.sessionData.countdowns[e]=n.getTime(),this.saveSession(),n}getTimerStartedAt(e){const i=this.sessionData.countdowns[e];return i?new Date(i):void 0}setCustomProperties(e,i){typeof i=="object"&&i.temporary?this.temporaryCustomProperties=this.getMergedCustomProperties(this.temporaryCustomProperties,e):typeof i=="boolean"&&i?this.customProperties=e:this.customProperties=this.getMergedCustomProperties(this.customProperties,e),this.saveCustomProperties()}isPageReloaded(){var e,i;return((i=(e=window.performance)==null?void 0:e.getEntriesByType("navigation")[0])==null?void 0:i.type)==="reload"}isReferrerExternal(e=document.referrer,i){if(this.isPageReloaded())return!1;if(e!==""){const n=ot(this.getCrossSubDomain(),i).hostname,s=document.createElement("a");return s.href=e,s.hostname.indexOf(n)===-1}return!0}getSourceDomain(){const e=this.getSource();if(e&&e!==""){const i=document.createElement("a");return i.href=e,i.hostname}return null}getSource(){return this.sessionData.src}getDoNotDisplay(){return!!this.noShow}getDisplayCount(e){const i=this.getPopup(e);return i&&i.dc?i.dc:0}getLastDisplayedInterval(e){const i=this.getPopup(e);if(i){const n=Math.abs(new Date(i.d).getTime()-new Date().getTime());return Math.floor(n/1e3/60)}else return 0}setDisplayed(e,i){const n=new Date().getTime(),s=this.getPopup(e);return s?(s.dc++,s.d=n):this.persistentData.popups[e]={dc:1,d:n},this.saveStored(),this.addSessionPopupId(e,i),!0}setClosed(e){const i=this.getPopup(e);return i?i.cl=1:this.persistentData.popups[e]={dc:1,d:new Date().getTime(),cl:1},this.saveStored(),!0}enableStickyTab(e){return this.sessionData.sticky[e]={},this.saveSession(),!0}disableStickyTab(e){return delete this.sessionData.sticky[e],this.saveSession(),!0}getStickyTab(e){return this.sessionData.sticky[e]||null}isStickyTab(e){return this.getStickyTab(e)!==null}setStickyTabFormSession(e,i){const n=this.getStickyTab(e);return n?(n.i=i,this.saveSession(),!0):!1}getStickyTabFormSession(e){var i;return((i=this.getStickyTab(e))==null?void 0:i.i)??null}setStickyTabStep(e,i){const n=this.getStickyTab(e);return n?(n.s=i,this.saveSession(),!0):!1}getStickyTabStep(e){var i;return((i=this.getStickyTab(e))==null?void 0:i.s)??null}getStickyTabUniqueCoupon(e){var i;return((i=this.getStickyTab(e))==null?void 0:i.c)??null}setStickyTabUniqueCoupon(e,i){const n=this.getStickyTab(e);return n?(n.c=i,this.saveSession(),!0):!1}getStickyTabData(e,i){const n=$e[i]||i;return(this.getStickyTab(e)||{})[n]??null}setStickyTabData(e,i,n){const s=this.getStickyTab(e);if(!s)return!1;const o=$e[i]||i;return s[o||i]=n,this.saveSession(),!0}isClosed(e){const i=this.getPopup(e);return!!(i&&i.cl)}isConverted(e){const i=this.getPopup(e);return!!(i&&i.c)}setConverted(e){const i=this.getPopup(e);if(i){const n=new Date;return i.c=n.getTime(),this.saveStored(),!0}else return!1}setTrafficChannel(e){this.trafficChannel=e}getTrafficChannel(){return this.trafficChannel}hasAnySubscription(){return!!this.persistentData.sub}setArrivalOnPage(e){const i=new Date;!this.arrivalOnPage&&e&&i.setTime(e),this.arrivalOnPage=i}getArrivalOnPage(){return this.arrivalOnPage||this.setArrivalOnPage(),this.arrivalOnPage}getUtmParameters(){return this.sessionData.utm}getVisits(){return this.visits}addVisit(){(this.isReferrerExternal()||!this.visits.length)&&(this.visits.unshift(this.getArrivalOnPage().toJSON())>I.visitsMaxSize&&(this.visits=this.visits.slice(0,I.visitsMaxSize)),this.saveVisits())}getPageViewCount(){return this.sessionData.pageviews}incrementPageViewCount(e){this.isReferrerExternal()&&!e?this.sessionData.pageviews=1:this.sessionData.pageviews++,this.saveSession()}getTestIp(){return this.sessionData.testIp}setTestIp(e){this.sessionData.testIp=e,this.saveSession()}incrementSessionPagesElapsed(){this.incrementSessionPagesElapsedForType("popups"),this.incrementSessionPagesElapsedForType("bars"),this.saveSession()}getCustomProperties(e){const i=this.getMergedCustomProperties({},this.customProperties),n=this.getMergedCustomProperties(i,this.temporaryCustomProperties);for(const s in n)if(n.hasOwnProperty(s))return e?{...lt(n)}:{...n};return{}}getUcrn(){return this.persistentData.ucrn===void 0||this.persistentData.ucrn===null?!1:this.persistentData.ucrn}getLastDisplayedAndConvertedPopups(){let e=null,i=null,n=null,s=null,o=null;return this.getPopupIds().forEach(r=>{const a=this.getPopup(r);a&&(o=new Date(a.d),(i===null||o.getTime()>i.getTime())&&(e=r,i=o),a.c&&(o=new Date(a.c),(s===null||o.getTime()>s.getTime())&&(n=r,s=o)))}),{displayPopId:e,displayDate:i,convertPopId:n,convertDate:s}}setSubscribed(e){return this.getPopup(e)?(this.persistentData.sub=1,this.saveStored(),!0):!1}getDebugData(){return{persistentData:this.persistentData,sessionData:this.sessionData,customProperties:this.customProperties,visits:this.visits,browserStorageUsed:this.browserStorageUsed,arrivalOnPage:this.arrivalOnPage,noShow:this.noShow,baseUrl:le,cookies:{...this.cookies,names:w},location:{...this.location}}}setArrivalOnSite(){(!this.sessionData.arrivalOnSite||this.isReferrerExternal())&&(this.sessionData.arrivalOnSite=this.getArrivalOnPage().toJSON())}getArrivalOnSite(){return this.sessionData.arrivalOnSite||this.setArrivalOnSite(),new Date(this.sessionData.arrivalOnSite)}setDevice(e){this.device=e}setUserLocation(e){this.location=e}getUserLocation(){return this.location}setUserIp(e){this.ip=e}getUserIp(){return this.ip}isPhoneDevice(){return ki(this.device)}isTabletDevice(){return Oi(this.device)}setRecommendationId(e,i){this.persistentData.bandit.recos[e]=i}getRecommendationId(e){return this.persistentData.bandit.recos[e]||null}getAllRecommendations(){return this.persistentData.bandit.recos}setBanditEventId(e,i){this.banditEventIds[e]=i}getBanditEventId(e){return this.banditEventIds[e]}setBanditId(e,i){this.banditIds[e]=i}getBanditId(e){return this.banditIds[e]}setDoNotDisplay(e=!0){if(e){const i=new Date;i.setTime(i.getTime()+I.msIn30Days),this.noShow=i}else this.noShow=null;this.saveNoShow()}getExternalSegments(){return this.sessionData.es}setExternalSegments(e){this.sessionData.es=e,this.saveSession()}getKlaviyoExchangeId(){let e=null;const i=G("__kla_id");if(i)try{const n=JSON.parse(atob(i));n.$exchange_id&&(e=n.$exchange_id)}catch{}return e}getPopup(e){return this.persistentData.popups[e]}getMergedCustomProperties(e,i){for(const n in i)i.hasOwnProperty(n)&&(i[n]===null?delete e[n]:i[n]instanceof Object?(e[n]=this.getMergedCustomProperties(e[n]instanceof Object?e[n]:{},i[n]),JSON.stringify(e[n])==="{}"&&delete e[n]):e[n]=i[n]);return e}initBrowserStorageUsed(){this.setBrowserStorageUsed(this.isBrowserStorageUsed(!0),!1)}initSession(){const e=this.getStorage(w.session);if(e)try{const i=JSON.parse(e),n=i.mtime?new Date(i.mtime):null;C.isSessionCookieRecent(n,Date.now())&&(this.sessionData={...this.sessionData,...i})}catch{}this.setSource(),this.setUtmParameters(),this.saveSession()}initCustomProperties(){const e=this.getStorage(w.properties);if(e)try{const i=JSON.parse(e);this.customProperties={...this.customProperties,...i}}catch{}}initVisits(){const e=this.getStorage(w.visits);if(e)try{this.visits=JSON.parse(e)}catch{}}initNoShow(){const e=this.getStorage(w.noShow);if(e==="1")this.setDoNotDisplay(!0);else if(e){const i=Ti(e);!i||C.isNoShowDateReached(i,Date.now())?this.removeStorage(w.noShow):this.noShow=i}}initExternalSubscribed(){this.hasAnySubscription()||(this.getKlaviyoExchangeId()!==null||G("MCPopupSubscribed")==="yes"||rt("utm_medium")==="email")&&(this.persistentData.sub=1,this.saveStored())}migrateCookieFormat(){let e=!1;(!this.persistentData.v||this.persistentData.v<C.STORAGE_VERSION)&&(e=!0,this.persistentData.v=C.STORAGE_VERSION,delete this.persistentData.version,this.persistentData.csd=this.persistentData.cross_subdomain?1:0,delete this.persistentData.cross_subdomain,this.visits.length===0&&this.persistentData.last_req_date&&this.visits.push(this.persistentData.last_req_date),delete this.persistentData.last_req_date,this.migratePopupsKeys(),this.removeStorage(w.persistent),this.removeStorage(w.properties)),e&&this.save()}migratePopupsKeys(){if(this.persistentData.popins){for(const e in this.persistentData.popins)this.persistentData.popins.hasOwnProperty(e)&&(this.persistentData.popups[e]={d:this.persistentData.popins[e].display_date,dc:this.persistentData.popins[e].display_count},this.persistentData.popins[e].converted&&(this.persistentData.popups[e].c=this.persistentData.popins[e].converted),this.persistentData.popins[e].subscribed&&(this.persistentData.sub=1));delete this.persistentData.popins}this.sessionData.popins&&(this.sessionData.popups=this.sessionData.popins,delete this.sessionData.popins)}setCookie(e,i,n,s="/",o){let r;(!n||typeof n=="number")&&(r=(n||this.cookies.ttl)*I.secondsInDay);let a;const c=ot(!0);return!o&&this.getCrossSubDomain()&&c.subDomainSkipped&&(a=`.${c.hostname}`),it(e,i,s||void 0,a,r,this.cookies.maxSize),!0}getStorage(e){return this.isBrowserStorageUsed()?at(e):G(e)}setStorage(e,i,n){return this.isBrowserStorageUsed()?Ei(e,i,n):this.setCookie(e,i,n)}testStorage(){const e="wisepops_test",i=this.setStorage(e,"test",!0);return i&&this.removeStorage(e),i}setCrossSubDomain(e){this.persistentData.csd=e?1:0}getCrossSubDomain(){return!!this.persistentData.csd}removeCookie(e){this.setCookie(e,"",-1),this.setCookie(e,"",-1,!1),this.setCookie(e,"",-1,window.location.pathname),this.setCookie(e,"",-1,void 0,!0),this.setCookie(e,"",-1,!1,!0),this.setCookie(e,"",-1,window.location.pathname,!0)}removeStorage(e){this.isBrowserStorageUsed()?Pi(e):this.removeCookie(e)}addSessionPopupId(e,i){const n=i==="bar"?"bars":"popups";this.sessionData[n][e]=0,this.saveSession()}save(){this.saveStored(),this.saveSession(),this.saveCustomProperties(),this.saveVisits(),this.saveNoShow()}saveStored(){try{const e=JSON.stringify(this.persistentData);this.setStorage(w.persistent,e)}catch(e){if(this.getPopupIds().length){const i=this.removeOldestTrackedPopup();q.log(p.warn,"Removing info about popup #"+i+" to make persistent cookie lighter"),this.saveStored()}else throw e}}saveSession(){try{this.sessionData.mtime=new Date().getTime();const e=JSON.stringify(this.sessionData);this.setStorage(w.session,e,!0)}catch(e){if(this.sessionData.src)this.chunkSessionDataSrc(),q.log(p.warn,"Removing URL query to make session cookie lighter"),this.saveSession();else if(Object.keys(this.sessionData.popups).length||Object.keys(this.sessionData.bars).length||Object.keys(this.sessionData.countdowns).length)q.log(p.warn,e),this.sessionData.popups={},this.sessionData.bars={},this.sessionData.countdowns={},this.saveSession();else throw e}}saveCustomProperties(){try{const e=JSON.stringify(this.customProperties);e.length<=2?this.removeStorage(w.properties):this.setStorage(w.properties,e)}catch(e){const i=Object.keys(this.customProperties);if(i.length>0)delete this.customProperties[i[0]],q.log(p.error,`Removing custom property "${i[0]}" to make persistent cookie lighter.`),this.saveCustomProperties();else throw e}}saveVisits(){this.setStorage(w.visits,JSON.stringify(this.visits))}saveNoShow(){this.noShow?this.setStorage(w.noShow,String(this.noShow.getTime())):this.removeStorage(w.noShow)}chunkSessionDataSrc(){if(this.sessionData.src){const e=document.createElement("a");e.href=this.sessionData.src;const i=e.port==="443"||e.port==="80"||!e.port?"":`:${e.port}`;this.sessionData.src=`${e.protocol}//${e.hostname}${i}`}}removeOldestTrackedPopup(){let e=null,i=null;for(const n in this.persistentData.popups)if(this.persistentData.popups.hasOwnProperty(n)){const s=new Date(this.persistentData.popups[n].d);(i===null||s.getTime()<i.getTime())&&(i=s,e=n)}return e&&delete this.persistentData.popups[e],e}generateUcrn(){return this.persistentData.ucrn=Math.floor(Math.random()*100)}setSource(e=document.referrer,i){this.isReferrerExternal(e,i)&&e&&(this.sessionData.src=e,this.saveSession())}setUtmParameters(e){const i=ct(dt),n=["gclid"];i.forEach(s=>{let o=s;n.indexOf(o)===-1&&(o="utm_"+o);let r=rt(o,e);r&&(n.indexOf(o)>-1&&(r="yes"),this.sessionData.utm[s]=r)})}incrementSessionPagesElapsedForType(e){for(const i in this.sessionData[e])this.sessionData[e].hasOwnProperty(i)&&this.sessionData[e][i]++}};ut.STORAGE_VERSION=4;let g=ut;(function(){if(typeof window.CustomEvent=="function")return!1;function t(e,i){i=i||{bubbles:!1,cancelable:!1,detail:null};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,i.bubbles,i.cancelable,i.detail),n}window.CustomEvent=t})();function pt(){return`wisp-${xe}-${J}`}function Di(){const t=pt(),e=document.cookie.split(";").map(i=>i.split("=").map(n=>n.trim())).find(([i])=>t===decodeURIComponent(i));return e?e[1]:null}function ft(t,e){var o;const i=pt();let n=`${encodeURIComponent(i)}=${encodeURIComponent(t)}`;(o=e.notifications)!=null&&o.domain&&(n=`${n};domain=.${e.notifications.domain}`),n=`${n};path=/`;const s=60*60*24*365;n=`${n};max-age=${s}`,n=`${n};SameSite=Lax`,document.cookie=n}function gt(){const t=new URLSearchParams(window.location.search),e=t.get("utm_source"),i=t.get("utm_medium"),n=t.get("utm_campaign"),s=t.get("utm_term"),o=t.get("utm_content");return!e&&!i&&!n&&!s&&!o?{}:{utm:{source:e,medium:i,campaign:n,term:s,content:o}}}async function ht(t,e,i=!1){let n=`${ei}/embed/visitor?website_id=${J}`;return t&&(n=`${n}&visitor_id=${t}`),e.client_id&&(n=`${n}&client_id=${e.client_id}`),i&&(n=`${n}&is_same_page=true`),await(await fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:`context=${encodeURIComponent(JSON.stringify(e)).replace(/%20/g,"+")}`})).json()}function Ci(){return window.innerWidth>document.documentElement.clientWidth}function _(){return window.innerWidth<=672}async function fe(t,e){const i=t();return e(i)?i:(await new Promise(n=>setTimeout(n,100)),fe(t,e))}function D(t){let e=!1,i;return function(...n){return e||(i=t.apply(this,n),e=!0),i}}function xi(t){let e;try{e=window[t];const i="__storage_test__";return e.setItem(i,i),e.removeItem(i),!0}catch(i){return i instanceof DOMException&&(i.code===22||i.code===1014||i.name==="QuotaExceededError"||i.name==="NS_ERROR_DOM_QUOTA_REACHED")&&e&&e.length!==0}}function Ue({tag:t="div",classList:e,style:i={},events:n={},onClick:s,...o}={},r=[]){const a=document.createElement(t);(Array.isArray(e)?e:[e]).forEach(c=>a.classList.add(c)),Object.entries(i).forEach(([c,d])=>a.style[c]=d),Object.entries(n).forEach(([c,d])=>a.addEventListener(c,d)),s&&a.addEventListener("click",s);for(const c in o)a.setAttribute(c,o[c]);return r.forEach(c=>a.appendChild(c)),a}function Ni(t,{viewBox:e,classList:i,onClick:n}={}){const s=document.createElementNS("http://www.w3.org/2000/svg","svg");return s.innerHTML=t,e&&s.setAttribute("viewBox",e),i&&s.setAttribute("class",i),n&&s.addEventListener("click",n),s}function Ri(t,{classList:e}={}){const i=document.createElement("iframe");return i.src=t,e&&i.classList.add(e),i}function Ai(t){return document.createRange().createContextualFragment(t)}const Li=t=>{var n,s,o,r;if(window.wisp.enabled)return!0;const e=_()?((n=t.notifications)==null?void 0:n.widget_type_mobile)??((s=t.notifications)==null?void 0:s.widget_type)??"custom":((o=t.notifications)==null?void 0:o.widget_type)??"custom",i=(r=t.notifications)==null?void 0:r.bell_enabled;return document.querySelectorAll(".wisp").length>0||e==="floating"||i&&e==="dragdrop"};function wt(t){var s,o,r,a;const e=_()?((s=t.notifications)==null?void 0:s.widget_type_mobile)??((o=t.notifications)==null?void 0:o.widget_type)??"manual":((r=t.notifications)==null?void 0:r.widget_type)??"manual",i=(a=t.notifications)==null?void 0:a.bell_enabled,n=document.querySelectorAll(".wisp");return n.forEach(c=>{c.classList.add("wisp_ready")}),i&&e==="dragdrop"?[mt(t,$i(t)),mt(t,Ui(t)),...Array.from(n)]:i&&e==="floating"?[_t(t),...Array.from(n)]:n.length>0?n:e==="floating"?[_t(t)]:[]}function $i(t){var e,i;return{selector:(e=t.notifications)==null?void 0:e.desktop_css_selector,position:(i=t.notifications)==null?void 0:i.desktop_position,device:"desktop"}}function Ui(t){var e,i;return{selector:(e=t.notifications)==null?void 0:e.mobile_css_selector,position:(i=t.notifications)==null?void 0:i.mobile_position,device:"mobile"}}function mt(t,e){var d,l;const i=document.getElementById("wisp_floating");i&&i.parentElement.removeChild(i);const n=e.selector,s=e.position,o=((d=t.notifications)==null?void 0:d.widget_icon_color)??"#FFFFFF",r=(l=t.notifications)==null?void 0:l.widget_image,a=Ai(`<div
class="wisp wisp-ready wisepops-bell"
role="button"
tabindex="0"
aria-label="Notifications"
>
<div
class="wisepops-bell wisepops-device-${e.device}"
style="mask-image: url('${r}');-webkit-mask-image: url('${r}');background-color: ${o};"
/>
</div>`).children[0],c=document.querySelector(n);return c&&n&&s&&c.insertAdjacentElement(s,a),a}function Mi(t){return/\.svg$/.test(t)}function _t(t){var y,ie,ne,se,oe,re,ae,De,Ce;const e=(y=t.notifications)==null?void 0:y.bell_enabled,i=document.getElementById("wisp_floating");i&&i.parentElement.removeChild(i);const n=((ie=t.notifications)==null?void 0:ie.widget_color)??"#000000",s=((ne=t.notifications)==null?void 0:ne.widget_icon_color)??"#FFFFFF",o=_()?((se=t.notifications)==null?void 0:se.widget_position_mobile)??((oe=t.notifications)==null?void 0:oe.widget_position)??"bottom_right":((re=t.notifications)==null?void 0:re.widget_position)??"bottom_right",r=((ae=t.notifications)==null?void 0:ae.widget_horizontal_offset)??0,a=((De=t.notifications)==null?void 0:De.widget_vertical_offset)??0,c=(Ce=t.notifications)==null?void 0:Ce.widget_image,d=t.notifications.widget_image_alt??"trigger wisp",l=e?0:20,u=document.createElement("div");u.id="wisp_floating",u.tabIndex="0",u.role="button",u.ariaLabel="Notifications",u.classList.add("wisp","wisp_ready","wisp_floating"),u.style.backgroundColor=n,u.style.bottom=`${l+a}px`,o==="bottom_right"?u.style.right=`${l+r}px`:o==="bottom_left"&&(u.style.left=`${l+r}px`);const h=document.createElement("div");if(h.classList.add("wisp_icon"),c){const Ws=Mi(c)?`<div class="wisepops-floating-bell" role="img" aria-label="${d}"
style="mask-image: url('${c}');-webkit-mask-image: url('${c}');background-color: ${s};"/>`:`<img src="${c}" alt="${d}" />`;h.classList.add("wisp_icon_image"),h.innerHTML=Ws}else h.innerHTML=`
      <svg width="16" height="16" fill="${s}" role="img">
        <title>${d}</title>
        <path d="M10 14H6c0 1.1.9 2 2 2s2-.9 2-2zM15 11h-.5c-.7-.7-1.5-1.7-1.5-3V5c0-2.8-2.2-5-5-5S3 2.2 3 5v3c0 1.3-.8 2.3-1.5 3H1c-.6 0-1 .4-1 1s.4 1 1 1h14c.6 0 1-.4 1-1s-.4-1-1-1z"/>
      </svg>
    `;u.appendChild(h);const f=document.createElement("div");return f.classList.add("wisp_close"),f.innerHTML=`
    <svg width="14" height="14" viewBox="0 0 14 14" fill="${s}">
      <path d="M13.7.3c-.4-.4-1-.4-1.4 0L7 5.6 1.7.3C1.3-.1.7-.1.3.3c-.4.4-.4 1 0 1.4L5.6 7 .3 12.3c-.4.4-.4 1 0 1.4.2.2.4.3.7.3.3 0 .5-.1.7-.3L7 8.4l5.3 5.3c.2.2.5.3.7.3.2 0 .5-.1.7-.3.4-.4.4-1 0-1.4L8.4 7l5.3-5.3c.4-.4.4-1 0-1.4z"/>
    </svg>
  `,u.appendChild(f),document.body.appendChild(u),u}function yt(t,e,i){var a;const n=i.filter(({seen:c})=>!c).length;if(n===0)return;const s=(a=t.notifications)==null?void 0:a.title_count,o=()=>{document.querySelectorAll(".wisp_count").forEach(l=>{l.parentNode.removeChild(l)}),s&&St(0),document.querySelectorAll(".wisp").forEach(l=>{l.removeEventListener("click",o)})};e.forEach((c,d)=>{var f,y,ie,ne,se,oe,re,ae;let l=c.querySelector(".wisp_count");if(!l){c.setAttribute("aria-labelledby",`wisp_count_${d}`),l=document.createElement("div"),l.classList.add("wisp_count"),l.role="status",l.id=`wisp_count_${d}`;const De=_()?((f=t.notifications)==null?void 0:f.widget_count_top_mobile)??((y=t.notifications)==null?void 0:y.widget_count_top):(ie=t.notifications)==null?void 0:ie.widget_count_top;l.style.top=`${De??"-2"}px`;const Ce=_()?((ne=t.notifications)==null?void 0:ne.widget_count_right_mobile)??((se=t.notifications)==null?void 0:se.widget_count_right):(oe=t.notifications)==null?void 0:oe.widget_count_right;l.style.right=`${Ce??"-2"}px`,l.style.background=((re=t.notifications)==null?void 0:re.widget_count_background)??"#ff3b30",l.style.color=((ae=t.notifications)==null?void 0:ae.widget_count_text_color)??"#ffffff",c.appendChild(l),c.addEventListener("click",o)}const u=`wisp-count-label-${d}`,h=`<span class="wisp_screen_reader_only" id="${u}">unread notification${n>1?"s":""}</span>`;l.innerHTML=`<span aria-labelledby="${u}" aria-live="polite">${n}</span>${h}`}),document.querySelectorAll(".wisp_extra_count").forEach(c=>{var l,u,h;let d=c.querySelector(".wisp_count");d||(d=document.createElement("div"),d.classList.add("wisp_count"),d.style.top=`${((l=t.notifications)==null?void 0:l.widget_extra_count_top)??"-8"}px`,d.style.right=`${((u=t.notifications)==null?void 0:u.widget_extra_count_right)??"-8"}px`,d.style.background=((h=t.notifications)==null?void 0:h.widget_count_background)??"#ff3b30",c.appendChild(d)),d.innerText=n}),s&&St(n)}let ge=null;function St(t=0){if(ge||(ge=window.document.title),!t){window.document.title=ge;return}window.document.title=`(${t}) ${ge}`}var N=(t=>(t.open="open",t.close="close",t.init="init",t.notifications="notifications",t.updatePushBannerVisibility="updatePushBannerVisibility",t.resize="resize",t))(N||{}),E=(t=>(t.resize="resize",t.loaded="loaded",t.update_height="update_height",t.feed_event="feed_event",t.redirect="redirect",t.wise_event="wise_event",t.feed_navigation="feed_navigation",t.refresh="refresh",t.init_height="init_height",t.close="close",t.reset_height="reset_height",t.subscribeToPushNotifications="subscribeToPushNotifications",t.showPushBanner="showPushBanner",t.hidePushBanner="hidePushBanner",t))(E||{});const vt="wisp";function M(t,e={}){const i=document.querySelector(".wisp_frame");i&&i.contentWindow&&i.contentWindow.postMessage({app:vt,type:t,...e},"*")}function k(t,e,i){window.addEventListener("message",n=>{const{app:s,type:o,...r}=n.data;s===vt&&o===t&&e(r)},i)}function bt(t,e){return new Promise(i=>k(t,i,e))}const he="--dynamic",Me=`${he}-widget-height`,V=`${he}-rect-y-top`,we=`${he}-rect-y-bottom`,Bi=`${he}-widget-viewport`,It="transform 0.3s, opacity 0.3s, visibility 0.3s",Fi="transform 0.3s, opacity 0.3s, visibility 0.3s, height 0.3s, top 0.3s, left 0.3s",Be=function(){let t;return{clear:function(){t=void 0},set:function(e){e instanceof Element&&(t=e)},focus:function(){t==null||t.focus({focusVisible:!0})}}}();async function Et(){return document.getElementById("wisp_container")!==null?!1:(document.body.appendChild(Ue({id:"wisp_container",classList:["wisp_container","wisp_container--close"],style:{transition:It}},[Ue({classList:"wisp_loader",events:{transitionend:t=>t.target.parentElement.removeChild(t.target)}},[Ue({classList:"wisp_loader_container"},[Ni('<circle class="wisp_loader_path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" />',{viewBox:"25 25 50 50",classList:"wisp_loader_circle"})])]),Ri(`${si}/feed.html?h=${L}`,{classList:"wisp_frame"})])),_()||ji(),await bt(E.loaded),document.querySelector(".wisp_loader").classList.add("wisp_loader--hide"),!0)}const ji=D(()=>{k(E.init_height,t=>me(t.height))});let B;function Pt(t){B=t[0],_()||W(B),Vi(),Hi(),Ki(),Gi(),Wi(),zi(),t.forEach(e=>{e.removeEventListener("click",Fe),e.addEventListener("click",Fe),e.removeEventListener("keydown",kt),e.addEventListener("keydown",kt)})}function kt(t){(t.key==="Enter"||t.key===" ")&&Fe(t)}function Fe(t){t.preventDefault(),t.stopPropagation(),Tt()?Z():Ji(Ot(t.target))}function Ot(t){if(t.classList.contains("wisp"))return t;if(t.parentElement)return Ot(t.parentElement)}const Vi=D(()=>{document.addEventListener("click",t=>{Tt()&&(document.querySelector(".wisp_container").contains(t.target)||Z())})}),Hi=D(()=>{k(E.close,()=>Z())}),Gi=D(()=>{k(E.update_height,({height:t})=>{_()||(me(t),W(B))})}),qi=({height:t})=>{_()&&(me(t),W(B))},Wi=D(()=>{k(E.reset_height,qi)}),zi=D(()=>{window.addEventListener("scroll",()=>{_()||W(B)})}),Ki=D(()=>{let t=_();window.addEventListener("resize",async()=>{if(t!==_()){const e=bt(E.refresh);M(N.resize,{isMobile:_()}),t=_();const i=await e;i.height&&me(i.height)}W(B)})});function Tt(){return document.querySelector(".wisp_container").classList.contains("wisp_container--open")}function Ji(t,e){B=t,Be.set(t),_()||W(t),t.classList.add("wisp--open");const i=document.querySelector(".wisp_container");i.classList.remove("wisp_container--close"),i.classList.add("wisp_container--open"),_()&&(Ci()&&document.body.classList.add("wisp_block_scrollbar"),document.body.classList.add("wisp_block")),M(N.open,{campaignId:e})}function Z(){B.classList.remove("wisp--open");const t=document.querySelector(".wisp_container");t.classList.remove("wisp_container--open");const e=()=>{t.removeEventListener("transitionend",e),!t.classList.contains("wisp_container--open")&&(M(N.close),t.classList.add("wisp_container--close"))};t.addEventListener("transitionend",e),document.body.classList.remove("wisp_block"),document.body.classList.remove("wisp_block_scrollbar"),Be.clear()}function me(t){const e=document.querySelector(".wisp_container");e.style.transition=Fi,e.style.height=Number.isNaN(Number(t))?t:`${t}px`,e.style.setProperty(Me,e.style.height);const i=()=>{e.style.transition=It,e.removeEventListener("transitionend",i)};e.addEventListener("transitionend",i)}function Yi({containerNode:t,top:e,windowHeight:i,offset:n,height:s}){e<i/2?(t.style.setProperty(V,`${e+s+n<0?"min":"max"}(${e+s+n}px, 24px)`),t.style.setProperty(we,`min(${i-24}px, calc(var(${V}) + 100vh - 24px - ${e+s+n}px))`)):(t.style.setProperty(V,"24px"),t.style.setProperty(we,e>i?"calc(100vh - 24px))":`${e-n}px`)),t.style.setProperty(Bi,`calc(var(${we}) - var(${V}))`)}function W(t){const e=document.querySelector(".wisp_container"),i=400,n=12,s=window.innerHeight,o=window.innerWidth,{top:r,left:a,height:c,width:d}=t.getBoundingClientRect();if(r===0&&a===0&&c===0&&d===0){Z();return}const l=r>=0||r<=s||a>=0||a<=o;e.style.position=l?"fixed":"absolute";const u=l?0:window.scrollY,h=l?0:window.scrollX;if(_()){e.style.setProperty("--top",""),e.style.setProperty(V,""),e.style.setProperty(we,""),e.style.left="",e.style.top="",e.style.height="",e.classList.remove("wisp_container_top","wisp_container_bottom");return}if(Yi({top:r,windowHeight:s,offset:n,height:c,containerNode:e}),a>o/2&&r<s/2){const f=`var(${V})`;e.style.setProperty("--top",f),e.style.top=`var(--top, ${f})`,e.style.left=`${a+h+d-i}px`,e.classList.add("wisp_container_top")}else if(a>o/2&&r>s/2){const f=`calc(${r+u-n}px - var(${Me}))`;e.style.setProperty("--top",f),e.style.top=`var(--top, ${f})`,e.style.left=`${a+h+d-i}px`,e.classList.add("wisp_container_bottom")}else if(a<o/2&&r>s/2){const f=`calc(${r+u-n}px - var(${Me}))`;e.style.setProperty("--top",f),e.style.top=`var(--top, ${f})`,e.style.left=`${a+h}px`,e.classList.add("wisp_container_bottom")}else if(a<o/2&&r<s/2){const f=`var(${V})`;e.style.setProperty("--top",f),e.style.setProperty("--top",`${r+u+c+n}px`),e.style.top=`var(--top, ${f})`,e.style.left=`${a+h}px`,e.classList.add("wisp_container_top")}}var _e=(t=>(t.wisepops_display="wisepops_display",t.wisepops_click="wisepops_click",t.wisepops_form_submit="wisepops_form_submit",t.wisepops_open_feed="wisepops_open_feed",t.wisepops_see_notification="wisepops_see_notification",t.wisepops_click_notification="wisepops_click_notification",t.wisepops_complete_notification="wisepops_complete_notification",t))(_e||{}),ye=(t=>(t.email="email",t.phone="phone",t.survey="survey",t))(ye||{});const Xi={wisepops_display:"Display",wisepops_click:"Click",wisepops_form_submitemail:"Signup",wisepops_form_submitphone:"Phone",wisepops_form_submitsurvey:"Survey completion"},Dt=function(){const t=[];if(typeof window.dataLayer=="object"&&window.dataLayer!==null){const e=window.google_tag_manager;if(typeof e=="object"&&e!==null)for(const i in e){const n=e[i];typeof n=="object"&&n!==null&&typeof n.dataLayer=="object"&&n.dataLayer!==null&&t.push(i)}}return t},Zi=function(){const t=Dt();for(const e of t)if(/^G-[A-Z0-9]{7,20}$/.test(e))return!0;return!1},Qi=t=>Object.prototype.toString.call(t)==="[object Arguments]",en=()=>{var t;return typeof window.gtag=="function"&&((t=window.dataLayer)==null?void 0:t.some(e=>{if(!Qi(e))return!1;const i=e;return i.length>=2&&typeof i[0]=="string"&&i[0]==="config"&&typeof i[1]=="string"&&i[1].startsWith("G-")}))},Se=function(t,e){const i=window[window.GoogleAnalyticsObject||"ga"],n=Xi[t+(e.form_type||"")]||t,s={...e};if(typeof window.gtag<"u"&&en())window.gtag("event",t,{...s,non_interaction:!0});else if(Zi()){const o={event:t};let r;for(r in s){const a=s[r];o[`wisepops_${r}`]=typeof a=="string"?a:JSON.stringify(a)}window.dataLayer&&window.dataLayer.push(o)}typeof i=="function"&&typeof i.getAll=="function"?i(()=>{const o=[],r=typeof window.gtag=="function"?Dt():[];i.getAll().forEach(a=>{const c=a.get("trackingId");!o.includes(c)&&!r.includes(c)&&(o.push(a.get("trackingId")),i(a.get("name")+".send","event","WisePops",n,e.label,{nonInteraction:!0}))})}):window._gaq&&typeof window._gaq.push=="function"&&typeof window.gtag!="function"&&window._gaq.push(["_trackEvent","WisePops",n,e.label,void 0,!0])},tn=["open_feed","see_notification","click_notification","complete_notification"],Ct=D(()=>{k(E.feed_event,({event:t,data:e})=>{if(tn.indexOf(t)!==-1){const i={};e.campaign_name&&(i.campaign_name=e.campaign_name),Se(`wisepops_${t}`,i)}t==="complete_notification"&&nn(e.payload)})});function nn({email:t}={}){if(!t)return;(window._learnq??[]).push(["identify",{$email:t,$source:"wisp"}])}const sn=`.wisp{position:relative;cursor:pointer}:where(.wisp:focus-visible){outline:2px solid #AE8FF1}.wisepops-bell,.wisepops-floating-bell,.wisepops-bell:empty,.wisepops-floating-bell:empty{display:block;height:24px;width:24px;mask-size:24px 24px;-webkit-mask-size:24px 24px}@media (max-width: 672px){.wisepops-device-mobile{display:block}.wisepops-device-desktop{display:none}}@media (min-width: 673px){.wisepops-device-mobile{display:none}.wisepops-device-desktop{display:block}}.wisp_floating{position:fixed;height:56px;width:56px;border-radius:100%;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 4px #00000040;z-index:9999997}.wisp_floating .wisp_count{height:19px;width:19px;line-height:19px}.wisp_floating .wisp_icon{display:flex;opacity:100;transition:opacity .3s}.wisp_floating .wisp_icon_image img{height:32px;width:32px;object-fit:cover}.wisp_floating .wisp_close{display:flex;position:absolute;top:21px;left:21px;opacity:0;transform:rotate(0);transition:opacity .3s,transform .3s}.wisp--open .wisp_icon{opacity:0}.wisp--open .wisp_close{opacity:100;transform:rotate(90deg)}.wisp_count{position:absolute;height:15px;width:15px;border-radius:100%;color:#fff;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-size:10px;font-weight:700;letter-spacing:normal;text-align:center;line-height:15px;cursor:pointer;-webkit-user-select:none;user-select:none}.wisp_screen_reader_only{position:absolute!important;overflow:hidden;opacity:0;pointer-events:none;height:0;width:0}.wisp_extra_count{position:relative}.wisp_container{position:fixed;width:400px;border-radius:4px;background-color:#fff;box-shadow:0 8px 16px #00000014;z-index:9999998;overflow:hidden;opacity:0;box-sizing:border-box;-webkit-user-select:none;user-select:none}.wisp_container_top{transform:translateY(-12px)}.wisp_container_bottom{transform:translateY(12px)}.wisp_container--open{opacity:100;visibility:visible;transform:translateY(0)}.wisp_container--close{width:0px;visibility:hidden}@media (max-width: 672px){.wisp_container{top:0px;left:0px;height:100%;width:100%;border:0;border-radius:0}}.wisp_container .wisp_frame{height:100%;width:100%;border:0}.wisp_container .wisp_loader{position:absolute;top:0;left:0;right:0;bottom:0;background-color:#fff;display:flex;align-items:center;justify-content:center;pointer-events:none;transition:opacity .3s}.wisp_container .wisp_loader--hide{opacity:0}.wisp_container .wisp_loader .wisp_loader_container{position:relative;height:56px;width:56px}.wisp_container .wisp_loader .wisp_loader_container .wisp_loader_circle{animation:wisp_loader_rotate 2s linear infinite}.wisp_container .wisp_loader .wisp_loader_container .wisp_loader_circle .wisp_loader_path{stroke:#3336;animation:wisp_loader_dash 1.5s ease-in-out infinite}@keyframes wisp_loader_rotate{to{transform:rotate(360deg)}}@keyframes wisp_loader_dash{0%{stroke-dasharray:1,200;stroke-dashoffset:0}50%{stroke-dasharray:89,200;stroke-dashoffset:-35px}to{stroke-dasharray:89,200;stroke-dashoffset:-124px}}.wisp_block{overflow:hidden}.wisp_block.wisp_block_scrollbar{padding-right:15px}
`,xt={mobile:"max-width: 672px",desktop:"min-width; 673px"},on=`
    @media (${xt.mobile}){
        .wisepops-desktop {
            display: none;
        }
    }

    @media (${xt.desktop}){
        .wisepops-mobile {
            display: none;
        }
    }
`;function rn(){H({event:"feed_exposure",time:Math.floor(Date.now()/1e3)}),v(S.EXPOSURE,{channel:"NOTIFICATION"})}function an(t,e){H({event:"open_feed",time:Math.floor(Date.now()/1e3),notification_count:t,new_notification_count:e}),document.dispatchEvent(new CustomEvent("wisp_event",{detail:{event:"open_feed",data:{notification_count:t,new_notification_count:e}}})),v(S.IMPRESSION,{channel:"NOTIFICATION",target:"feed",event:"open_feed",notification_count:t,new_notification_count:e})}function cn(t,e,i){H({event:"see_notification",time:Math.floor(Date.now()/1e3),campaign_id:t,position:e}),document.dispatchEvent(new CustomEvent("wisp_event",{detail:{event:"see_notification",data:{campaign_id:t,position:e}}})),v(S.IMPRESSION,{channel:"NOTIFICATION",event:"see_notification",campaignId:`wisp_${t}`,position:e}),i.recommendation&&v(S.EXPOSURE,{channel:"RECO",event:"see_notification"})}function ln({recommendation:t,notification:{position:e,campaignId:i}}){v(S.ENGAGEMENT,{channel:"RECO",event:"open_reco",...t}),v(S.ENGAGEMENT,{channel:"NOTIFICATION",event:"complete_notification",campaignId:`wisp_${i}`,position:e,productId:t.product.id}),H({event:"complete_notification",time:Math.floor(Date.now()/1e3),campaign_id:i,position:e,product_id:t.product.id},!0)}function dn(t){v(S.IMPRESSION,{channel:"RECO",event:"see_product",...t})}function un(t){v(S.IMPRESSION,{channel:"RECO",event:"open_feed",...t})}function pn(t,e,i={}){H({event:"click_notification",time:Math.floor(Date.now()/1e3),campaign_id:t,position:e}),document.dispatchEvent(new CustomEvent("wisp_event",{detail:{event:"click_notification",data:{campaign_id:t,position:e,...i}}})),v(S.IMPRESSION,{channel:"NOTIFICATION",event:"click_notification",campaignId:`wisp_${t}`,position:e,...i})}function fn(t,e,i=null){H({event:"complete_notification",time:Math.floor(Date.now()/1e3),campaign_id:t,position:e,payload:i},!0),document.dispatchEvent(new CustomEvent("wisp_event",{detail:{event:"complete_notification",data:{campaign_id:t,position:e,payload:i}}})),v(S.ENGAGEMENT,{channel:"NOTIFICATION",event:"complete_notification",campaignId:`wisp_${t}`,elements:i!=null&&i.email?["email"]:void 0,position:e})}function gn(t){t!=null&&(typeof t!="object"&&(t={value:t}),H({event:"goal",time:Math.floor(Date.now()/1e3),...t},!0),document.dispatchEvent(new CustomEvent("wisp_event",{detail:{event:"goal",data:t}})))}const H=(()=>{let t=[],e=null,i=!1;return(n,s=!1)=>{if(t=[...t,n],e&&(clearTimeout(e),e=null),s){const o=[...t];t=[],je(o);return}e=setTimeout(()=>{const o=[...t];t=[],e=null,je(o)},1e3),i||(i=!0,window.addEventListener("beforeunload",()=>{if(t.length===0)return;const o=[...t];t=[],je(o)}))}})();async function je(t){const e=new URLSearchParams;e.append("website_id",J),e.append("visitor_id",window.wisp.config.visitorId),await fetch(`${xe}/embed/events?${e.toString()}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:`events=${encodeURIComponent(JSON.stringify(t)).replace(/%20/g,"+")}`}),document.dispatchEvent(new CustomEvent("wisp_sync_events"))}const Nt="push_hide_until";function hn(){if(!xi("localStorage"))return!0;const t=localStorage.getItem(Nt);if(t===null)return!0;if(t==="never")return!1;const e=new Date(parseInt(t));return isNaN(e.getTime())||Date.now()>e.getTime()}function Rt(){hn()&&M(N.updatePushBannerVisibility,{visible:!0})}function Ve({keepHiddenDaysAmount:t}={keepHiddenDaysAmount:null}){let e="never";if(typeof t=="number"){const i=new Date;i.setDate(i.getDate()+t),e=i.getTime()}localStorage.setItem(Nt,`${e}`),M(N.updatePushBannerVisibility,{visible:!1})}const At=D(()=>{k(E.redirect,({url:t,target:e})=>{e==="_parent"?window.location.href=t:e==="_blank"&&window.open(t)}),k(E.feed_event,({event:t,data:e})=>{switch(t){case"open_feed":an(e.notification_count,e.new_notification_count),e.has_push_enabled&&v(S.EXPOSURE,{channel:X.PUSH,target:"subscribe_request"});break;case"open_recommendations_feed":un({reco_count:e.recommendations_count});break;case"see_recommendation_product":dn({product:e.product,position:e.position});break;case"open_recommendation_product":ln({recommendation:{product:e.product,position:e.position},notification:{campaignId:e.notification.campaignId,position:e.notification.position}});break;case"see_notification":cn(e.campaign_id,e.position,e.details);break;case"click_notification":pn(e.campaign_id,e.position,e.details);break;case"complete_notification":fn(e.campaign_id,e.position,e.payload);break}}),k(E.wise_event,({event:t,data:e})=>{switch(t){case"complete_notification":window.wisepops&&(wisepops("properties",{notificationId:e.campaign_id},{temporary:!0}),wisepops("event","notification-complete"));break}}),k(E.feed_navigation,({event:t})=>{switch(t){case"focus_trigger":Be.focus(),Z()}}),k(E.hidePushBanner,Ve),k(E.showPushBanner,Rt)}),Lt=async()=>{const{clientId:t,productId:e,variantId:i}=wn();let n=await _n(e,i);t&&(n={...n,client_id:t});const s=mn();return s&&window.wisp.goal(s),yn(),n};function wn(){var n,s,o;const t=(n=Shopify==null?void 0:Shopify.checkout)==null?void 0:n.customer_id,e=((o=(s=ShopifyAnalytics==null?void 0:ShopifyAnalytics.meta)==null?void 0:s.product)==null?void 0:o.id)??"",i=new URLSearchParams(window.location.search).get("variant")??"";return{clientId:t,productId:e,variantId:i}}function mn(){var n,s,o;const t=(n=Shopify==null?void 0:Shopify.Checkout)==null?void 0:n.page;if(!t||t.indexOf("thank_you")<0)return;const e=(s=Shopify==null?void 0:Shopify.checkout)==null?void 0:s.total_price,i=(o=Shopify==null?void 0:Shopify.checkout)==null?void 0:o.order_id;if(e!=null)return{value:parseFloat(e),order_id:i}}async function _n(t,e){var n;const i=(n=document.currentScript)!=null&&n.src.includes("website_id")?`/tools/wisp/context/${t}/${e}`:`/a/wisepops/context/${t}/${e}`;try{return await(await fetch(i)).json()}catch{return console.log("Wisepops: Failed to fetch the Shopify context"),{}}}const yn=D(()=>{const t=["Added Product"],e=ShopifyAnalytics&&ShopifyAnalytics.lib&&ShopifyAnalytics.lib.track;e&&(ShopifyAnalytics.lib.track=function(...i){const[n]=i;t.includes(n)&&window.wisp.update(),e.apply(this,i)})});function Sn(t){return decodeURIComponent(atob(t).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))}let R={};if(Ze.length>0)try{R=JSON.parse(Sn(Ze))}catch{console.error("Failed to parse Wisepops settings"),R={}}const $t=D(async(t,e)=>{var o;if(!(((o=R.push)==null?void 0:o.enabled)??!1))return;if(!("serviceWorker"in navigator)){console.error("serviceWorker is not supported");return}if(!("PushManager"in window)){console.error("PushManager is not supported");return}if(Notification.permission==="denied")return;let i;const n=e?"/a/wisepops/serviceWorker.js":"/serviceWorker.js";try{i=await navigator.serviceWorker.register(`${n}?h=${L}`)}catch{console.error("Failed to register Wisepops service worker");return}if(Notification.permission==="granted")return;Rt();let s=!1;k(E.subscribeToPushNotifications,async()=>{if(s)return;s=!0,v(S.IMPRESSION,{channel:X.PUSH,target:"subscribe_request"});let r="default";try{r=await vn()}catch{}if(r==="default"){s=!1;return}if(r==="denied"){Ve(),v(S.ENGAGEMENT,{channel:X.PUSH,target:"subscribe_request",subscribed:!1});return}v(S.ENGAGEMENT,{channel:X.PUSH,target:"subscribe_request",subscribed:!0}),Ve(),await In(i,t)})});function vn(){return new Promise((t,e)=>{const i=Notification.requestPermission(n=>t(n));i&&i.then(t,e)})}function bn(t){const e="=".repeat((4-t.length%4)%4),i=(t+e).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(i),s=new Uint8Array(n.length);for(let o=0;o<n.length;++o)s[o]=n.charCodeAt(o);return s}async function In(t,e){const i=await t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:bn(ri)});await fetch(`${Ne}/subscriptions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({websiteId:J,visitorId:e,subscription:i})})}const En=t=>typeof t=="string"?t:t.handle,Pn=async t=>{var n,s;const e=((s=(n=window.Shopify)==null?void 0:n.routes)==null?void 0:s.root)??"/",i=await fetch(`${e}products/${t}.js`);if(i.ok)return i.json()},kn=async t=>{const e=t.map(Pn);return(await Promise.allSettled(e)).filter(n=>(n==null?void 0:n.status)==="fulfilled")},On=async t=>(await kn(t)).map(i=>({handle:i.value.handle,featured_image:i.value.featured_image,price:i.value.price,title:i.value.title,url:i.value.url,id:i.value.id})),Tn=(()=>{const t="wisepops_recommendation_products";let e=JSON.parse(sessionStorage.getItem(t))??{};const i=n=>{sessionStorage.setItem(t,JSON.stringify(n)),e=n};return async n=>{const s=n.map(En),o=s.filter(c=>!e[c]),r=await On(o),a=s.reduce((c,d)=>{const l=r.find(({handle:u})=>d===u)??e[d];return l&&(c[d]=l),c},{});return i({...e,...a}),a}})(),Ut=g.getInstance(),Mt=()=>{const t="wisp_embed_style";if(document.getElementById(t)!==null)return;const e=document.createElement("style");e.id=t,e.innerHTML=`${sn};${on}`,document.head.appendChild(e)},Bt=t=>Promise.all(t.map(async e=>{var i;return(i=e.products)!=null&&i.length&&(e.products=await Tn(e.products).then(n=>Object.values(n))),e}));async function Dn(t=Ut){var c,d;if(window.wisp.started)return;window.wisp.started=!0;let e=!1,i={custom:t.getCustomProperties()};if(window.Shopify){const l=await Lt();i={...i,...l},e=!0}await fe(()=>Li(R),l=>l),window.wisp.enabled=!0,Mt();const n=x!==null?x.id:Di(),[{visitor_id:s,notifications:o}]=await Promise.all([ht(n,{...i,...gt(),url:window.location.href}),Et()]),r=await Bt(o);ft(s,R),window.wisp={...window.wisp,ready:!0,config:{visitorId:s,settings:R},context:i,notifications:r};const a=await fe(()=>wt(R),l=>l.length>0);rn(),Pt(a),yt(R,a,r),At(),M(N.init,{visitorId:s,settings:R,notifications:r,isMobile:_(),host:window.location.host,currency:(c=window.Shopify)==null?void 0:c.currency,locale:((d=window.Shopify)==null?void 0:d.locale)??"en"}),Ct(),$t(s,e)}async function Cn(t={},e=Ut){var d,l;if(window.wisp.ready===!1){setTimeout(()=>window.wisp.update(t),100);return}window.wisp.ready=!1;const{visitorId:i,settings:n}=window.wisp.config;if(t={...t,custom:{...e.getCustomProperties(),...t.custom}},window.Shopify){const u=await Lt();t={...t,...u}}Mt();const[{visitor_id:s,notifications:o},r]=await Promise.all([ht(i,{...t,...gt(),url:window.location.href}),Et()]),a=await Bt(o);ft(s,n),window.wisp={...window.wisp,ready:!0,config:{...window.wisp.config,visitorId:s},context:t,notifications:a};const c=await fe(()=>wt(n),u=>u.length>0);Pt(c),yt(n,c,a),At(),Ct(n),$t(n),r?M(N.init,{visitorId:s,settings:n,notifications:a,isMobile:_(),host:window.location.host,currency:(d=window.Shopify)==null?void 0:d.currency,locale:((l=window.Shopify)==null?void 0:l.locale)??"en"}):M(N.notifications,{notifications:a})}function xn(t){if(window.wisp.ready===!1){window.wisp.enabled=!0,setTimeout(()=>window.wisp.goal(t),100);return}gn(t)}window.wisp||(window.wisp={started:!1,ready:!1,enabled:!1,config:{visitorId:null,settings:null},context:null,notifications:null,update:Cn,goal:xn,debug(){console.log(`
Visitor Id: ${this.config.visitorId}
Settings: ${JSON.stringify(this.config.settings,null,2)}
Context: ${JSON.stringify(this.context,null,2)}
Notifications: ${JSON.stringify(this.notifications,null,2)}
      `)},start:(t,e,i)=>{i&&window.wisp.update(i)},newPage:(t={})=>{window.wisp.update(t)},updateContext:(t={})=>{window.wisp.update(t)}});var Nn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ft={};(function(t){(function(e){function i(n){for(var s=n.length,o,r;s!==0;)r=Math.floor(Math.random()*s),s-=1,o=n[s],n[s]=n[r],n[r]=o;return n}e.knuthShuffle=i})(t||typeof window<"u"&&window||Nn)})(Ft);var z=(t=>(t.AFTER_INITIALIZATION="after-initialization",t.BEFORE_TAB_DISPLAY="before-tab-display",t.BEFORE_POPUP_DISPLAY="before-popup-display",t.BEFORE_FORM_SUBMIT="before-form-submit",t.AFTER_FORM_SUBMIT="after-form-submit",t.BEFORE_TRACKED_CLICK="before-tracked-click",t.AFTER_TRACKED_CLICK="after-tracked-click",t.AFTER_POPUP_CLOSE="after-popup-close",t))(z||{}),F=(t=>(t.POPUP="popup",t.BAR="bar",t.EMBED="embed",t.STICKY="sticky",t))(F||{});const Rn=t=>!0;let He;function An(){const t=e=>{e.state&&e.state.wisepops==="exit-intent"&&setTimeout(()=>{(!He||!He())&&window.history.back()},0)};window.addEventListener("popstate",t)}function Ln(t,e){if(He=t,e===1&&!(window.history.state&&window.history.state.wisepops==="normal-intent")){const i=()=>{var s;window.history.replaceState({wisepops:"exit-intent"},""),((s=window.history.state)==null?void 0:s.wisepops)==="exit-intent"&&(window.removeEventListener("touchstart",i),window.removeEventListener("touchend",i),window.history.pushState({wisepops:"normal-intent"},""))};window.addEventListener("touchend",i),window.addEventListener("touchstart",i),("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)&&i()}}let ve;function $n(t){ve=new CustomEvent(`wisepops.${z.AFTER_INITIALIZATION}`,{detail:{wisepops:t,properties:t._getCustomProperties()},bubbles:!1,cancelable:!1}),document.dispatchEvent(ve)}const Un={get(t,e){return e==="target"?t.detail.target??t.target:typeof t[e]=="function"?(...i)=>t[e](...i):t[e]}};function Mn(t){return function(e){return t(new Proxy(e,Un))}}function Bn(t,e,i){if(t===z.AFTER_INITIALIZATION&&ve){e(ve);return}document.addEventListener(`wisepops.${t}`,Mn(e),i)}const Q=U.getInstance();function Fn(...t){if(t.length<2){Q.log(p.error,'Method "listen(eventName, popupIdOrListener, [listener])" requires at least 2 parameters');return}const[e,i,n,s]=t,o=ct(z),r="wisepops.",a=typeof e=="string"&&e.indexOf(r)===0?e.substr(r.length):e;if(typeof a!="string"||!o.includes(a)){Q.log(p.error,`Event ${e} is not a valid WisePops event. Valid events are: 
${o.join(`,
`)}`);return}const c=parseInt(`${i}`,10),d=isNaN(c)?i:n;if(!d){Q.log(p.error,'Method "listen(eventName, popupIdOrListener, [listener])" requires a listener as 2nd or 3rd parameter');return}if(typeof d!="function"){Q.log(p.error,'Method "listen(eventName, popupIdOrListener, [listener])" requires listener to be a function');return}a===z.AFTER_INITIALIZATION&&c&&Q.log(p.warn,`Listening to ${z.AFTER_INITIALIZATION} event does not requires a popupId params. ${c} will be ignored.`),jt(a,d,c,s)}function jt(t,e,i,n){Bn(t,i?s=>{s.detail&&s.detail.popup&&s.detail.popup.id!==i||e(s)}:e,n)}const be=(()=>{const t=()=>new Promise(o=>{e=o});let e,i=t(),n;const s=o=>e==null?void 0:e(o);return{setExitHandler:s,getExitHandler:()=>i,setResetExitHandler:o=>n=o,resetExitHandler:()=>{n&&(i=t(),s(n()))}}})(),Ge=new Set,jn=t=>{if(t.e==="d"&&t.p&&Ge.delete(t.p),!(!fi.includes(t.e)||!t.p)){if(!Ge.has(t.p)){Ge.add(t.p);return}t.tc="1"}},Vn=function(t,e){let i=0,n=!1,s;for(s in e){const o=/fields\[(\d+)\]\[(.+)\]/.exec(s);o!=null&&o[1]&&parseInt(o[1],10)===i&&(i=parseInt(o[1],10)+1),o!=null&&o[2]&&o[2]==="tag"&&e[s]==="vuid"&&(n=!0)}return i>0&&!n&&(e[`fields[${i}][name]`]="zaius_vuid",e[`fields[${i}][type]`]="hidden",e[`fields[${i}][value]`]=t,e[`fields[${i}][tag]`]="vuid"),e},Ie=function(t,e=()=>null){let i=le.tracking+"/_.gif?";Re.includes(t.e)&&window.zaius&&window.zaius.VUID&&(t=Vn(window.zaius.VUID,t)),Re.includes(t.e)&&t.recaptcha_token||(t.recaptcha_token=void 0);const s=g.getInstance().getTestIp();s&&(t.ip=s),jn(t);let o;for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&t[o]!==void 0&&(i+=o+"="+encodeURIComponent(t[o])+"&");if(i+="site="+tt,i+="&url="+encodeURIComponent(window.location.href.slice(0,1e3)),t.form_session===void 0&&t.discount_block_id===void 0&&navigator.sendBeacon(i))e();else{const r=new XMLHttpRequest;r.addEventListener("load",function(){const a=JSON.parse(this.responseText);a.code&&t.form_session===void 0&&e(a.code||null),e({code:a.code||"",formSession:a.formSession||""})}),r.open("POST",i),r.send()}},Hn=(t,e,i,n)=>{n=n||F.POPUP;const s=g.getInstance();s.setDisplayed(t,n),Se(_e.wisepops_display,{label:e}),Ie({e:"d",p:t,banditId:s.getBanditId(String(t)),banditEventId:s.getBanditEventId(String(t))},i)},Gn=(t,e,i)=>{const n=g.getInstance();n.setConverted(t)&&(Se(_e.wisepops_click,{label:e}),Ie({e:"c",p:t,banditId:n.getBanditId(String(t)),banditEventId:n.getBanditEventId(String(t))},i))},qn=(t,e,i,n,s,o,r,a)=>{qe("s",t,e,i,n,s,o,r,a)},Wn=(t,e,i,n,s,o,r,a)=>{qe("p",t,e,i,n,s,o,r,a)},zn=(t,e,i,n,s,o,r,a)=>{qe("e",t,e,i,n,s,o,r,a)},qe=(t="e",e,i,n,s,o,r,a,c)=>{const d=u=>{switch(u){case"s":return ye.survey;case"p":return ye.phone;default:return ye.email}},l=g.getInstance();if(l.setConverted(e)&&l.setSubscribed(e)){Se(_e.wisepops_form_submit,{label:i,form_type:d(t)});const u={...c,e:t,p:e,banditId:l.getBanditId(String(e)),banditEventId:l.getBanditEventId(String(e))};n&&s.unshift({name:"email",type:"email",value:n}),r&&(u.recaptcha_token=r),a&&(u.discount_block_id=a);for(let h=0;h<s.length;h++)u["fields["+h+"][name]"]=""+s[h].name,u["fields["+h+"][value]"]=""+s[h].value,typeof s[h].type=="string"&&(u["fields["+h+"][type]"]=""+s[h].type),s[h].tag!==null&&s[h].tag!==void 0&&(u["fields["+h+"][tag]"]=""+s[h].tag);Ie(u,o)}},A={_trackDisplay:Hn,_trackClick:Gn,_trackSignup:zn,_trackSurvey:qn,_trackPhone:Wn,_hasFeature:Rn,_isConverted:t=>g.getInstance().isConverted(t),_getPageViewCount:()=>g.getInstance().getPageViewCount(),_getArrivalOnPage:()=>g.getInstance().getArrivalOnPage(),_isPhoneDevice:()=>g.getInstance().isPhoneDevice(),_isTabletDevice:()=>g.getInstance().isTabletDevice(),_getUserLocation:()=>g.getInstance().getUserLocation(),_getTrafficChannel:()=>g.getInstance().getTrafficChannel(),_getUserIp:()=>g.getInstance().getUserIp(),_getSource:()=>g.getInstance().getSource(),_getSourceDomain:()=>g.getInstance().getSourceDomain(),_getUTMParameters:()=>g.getInstance().getUtmParameters(),_getCustomProperties:t=>g.getInstance().getCustomProperties(t),_setTimerStarted:t=>g.getInstance().setTimerStarted(t),_getTimerStartedAt:t=>g.getInstance().getTimerStartedAt(t),_setDoNotDisplay:()=>g.getInstance().setDoNotDisplay(),_getDoNotDisplay:()=>g.getInstance().getDoNotDisplay(),_setClosed:t=>g.getInstance().setClosed(t),_enableStickyTab:t=>g.getInstance().enableStickyTab(t),_disableStickyTab:t=>g.getInstance().disableStickyTab(t),_isStickyTab:t=>g.getInstance().isStickyTab(t),_setStickyTabData:(t,e,i)=>g.getInstance().setStickyTabData(t,e,i),_getStickyTabData:(t,e)=>g.getInstance().getStickyTabData(t,e),_setStickyTabFormSession:(t,e)=>g.getInstance().setStickyTabFormSession(t,e),_getStickyTabFormSession:t=>g.getInstance().getStickyTabFormSession(t),_setStickyTabStep:(t,e)=>g.getInstance().setStickyTabStep(t,e),_getStickyTabStep:t=>g.getInstance().getStickyTabStep(t),_getStickyTabUniqueCoupon:t=>g.getInstance().getStickyTabUniqueCoupon(t),_setStickyTabUniqueCoupon:(t,e)=>g.getInstance().setStickyTabUniqueCoupon(t,e),_log:(...t)=>U.getInstance().log(...t),_setExitHandler:be.setExitHandler,_getExitHandler:be.getExitHandler,_resetExitHandler:be.resetExitHandler,_setResetExitHandler:be.setResetExitHandler,_registerBackExitTrigger:t=>Ln(t,g.getInstance().getPageViewCount()),_listen:jt,_registerBundle:t=>_s(t),_getRecaptchaSiteKey:()=>g.getInstance().getRecaptchaSiteKey()},Kn=t=>{const e=`.observer-pixel-${t}`;if(document.querySelector(e))return e;const n=`<div class="observer-pixel-${t}"><style>
${e}{width: 1px;height: 1px;position: absolute;left: 0;margin-top: 100vh;top: ${t}%; pointer-events: none;}
</style></div>`;return document.body.insertAdjacentHTML("beforeend",n),e},Jn=(t,e,i)=>{const n=document.querySelectorAll(e);if(!n.length)return;const s=new IntersectionObserver(t,i);return n.forEach(o=>s.observe(o)),s};function Yn(t){const e=t.sensitivity??20,i=t.timer??1e3,n=t.delay??0,s=t.callback,o=document.documentElement;let r=null,a=!1;function c(y){a||!y.metaKey||y.keyCode!==76||(a=!0,r=setTimeout(f,n))}function d(){r&&(clearTimeout(r),r=null)}function l(y){y.clientY>e||(r=setTimeout(f,n))}function u(){o.addEventListener("mouseleave",l),o.addEventListener("mouseenter",d),o.addEventListener("keydown",c)}setTimeout(u,i);function h(){o.removeEventListener("mouseleave",l),o.removeEventListener("mouseenter",d),o.removeEventListener("keydown",c)}function f(){s(),h()}return{fire:f,disable:h}}let Vt=window.innerHeight<window.innerWidth,Ht=window.innerHeight;const Xn=t=>{const e=()=>{const i=window.innerHeight<window.innerWidth;Vt===i&&window.innerHeight<Ht&&(window.removeEventListener("resize",e),t()),Vt=i,Ht=window.innerHeight};window.addEventListener("resize",e)},Gt=({triggerExitScrollup:t,lazy:e})=>{const i=()=>new Promise(s=>{let o=!1;const r=()=>{o||(s(),o=!0)};Yn({callback:r}),(A._isPhoneDevice()||A._isTabletDevice())&&(t&&Xn(r),A._registerBackExitTrigger(()=>o?!1:(r(),!0)))}),n=i();return A._setResetExitHandler(i),A._setExitHandler(n),e?n:Promise.resolve()},We=1e3,Zn=5*We,Qn=.5*We,es=-1,ts="50%",is="100%",ns=window.requestIdleCallback??(t=>t()),Ee=(t,e={rootMargin:ts})=>{let i;return t?new Promise(n=>{try{i=Jn(as(n),t,e)}catch{n("fallback")}}).then(()=>i==null?void 0:i.disconnect()):Promise.resolve()},ss=({popupType:t,selector:e})=>t==="embed"?Ee(e,{rootMargin:is}):Promise.resolve(),qt=({delay:t,...e})=>t&&!A._isStickyTab(e.popupId)?new Promise(i=>setTimeout(i,t*We-Qn-(Date.now()-A._getArrivalOnPage().getTime()))):ss(e),os=()=>new Promise(t=>ns(()=>setTimeout(t,Zn))),rs=()=>Promise.resolve(),as=t=>e=>{var i;(i=e[0])!=null&&i.isIntersecting&&t(!0)},cs={landing:qt,exit:async t=>(t.delay&&await qt(t),Gt(t)),scroll:({triggerScrollPercent:t})=>t?Ee(Kn(es+Number(t)),{}):Promise.resolve(),hover:({triggerHoverElement:t})=>Ee(`#${t}`),click:({triggerClickAnchor:t})=>Ee(`[href*='${t}']`)};async function ls(t,e){return Promise.race([(cs[t.trigger]??rs)(t),os(),e])}const ds={[F.BAR]:1,[F.POPUP]:1,[F.EMBED]:1/0,[F.STICKY]:1},P={};function us(t){ee(t.popupId)||(P[t.popupId]={details:{...t,weight:ze(t)}})}function ps(t,e,i){const n=document.createElement("script");n.type="text/javascript",n.async=!0,n.setAttribute("charset","UTF-8"),n.src=`${le.cdn}/shared/wisepops/${t}/${e}.js?v=${encodeURIComponent(i)}`,document.body.appendChild(n)}function fs(t,e){const{popupId:i,popupType:n,popupVersion:s}=t;if(ee(i))gs(i);else{P[i]={details:{popupId:i,popupVersion:s,popupType:n,weight:ze(t)}};const o=new Promise((r,a)=>{P[i].cancelLoading=a});ls(t,o).then(()=>ps(e,i,s),()=>U.getInstance().log("info",`Campaign ${i}: loading was cancelled`))}}function gs(t){var i;const e=(i=P[t])==null?void 0:i.bundle;if(!e)throw new Error(`No bundle for popup #${t}. You need to load it first.`);e.start()}function hs(t){var e,i,n,s;(i=(e=P[t])==null?void 0:e.bundle)==null||i.destroy(),(s=(n=P[t])==null?void 0:n.cancelLoading)==null||s.call(n),delete P[t]}function ee(t){var e;return!!((e=P[t])!=null&&e.bundle)}function ze(t){return t.triggerClickAnchor?0:1}function ws(t){return Object.keys(P).reduce((e,i)=>{var n,s;return((s=(n=P[i])==null?void 0:n.details)==null?void 0:s.popupType)===t?P[i].details.weight+e:e},0)}function ms(t){const e=ze(t);return e===0?!1:ws(t.popupType)+e>ds[t.popupType]}function _s(t){P[t.popupId]?P[t.popupId].bundle=t:t.destroy()}function Wt(t){Object.keys(P).forEach(e=>{t(P[e])&&hs(e)})}const j={};let Ke=!1;function ys(){Ke||(Ke=!0,setTimeout(()=>{Object.keys(j).forEach(t=>{const e=j[t];if(e){const i=document.querySelector(t);i&&(e.forEach(n=>n(i)),delete j[t])}}),Object.keys(j).length===0&&Je.disconnect(),Ke=!1},500))}const Je=new MutationObserver(ys);function Ss(t){const e=document.querySelector(t);return e?Promise.resolve(e):new Promise(i=>{let n=j[t];n||(n=new Set,j[t]=n),n.add(i),Je.observe(document,{subtree:!0,childList:!0,attributes:!0})})}function zt(t){return Ss(t)}function vs(){Object.keys(j).forEach(t=>delete j[t]),Je.disconnect()}let Pe;function bs(t){return Pe&&!t.e&&Pe.abort(),new Promise((e,i)=>{const n=le.popup+"/my-wisepop";let s="";for(const r in t)t.hasOwnProperty(r)&&(s+=r+"="+encodeURIComponent(t[r])+"&");s.length&&(s=s.slice(0,-1));let o=null;if(XMLHttpRequest&&(o=new XMLHttpRequest,!o))throw new Error("Your browser does not support XHR");o&&(t.e||(Pe=o),o.onload=function(){t.e||(Pe=void 0),e(JSON.parse(this.responseText))},o.onerror=i,o.open("POST",n,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.setRequestHeader("Accept","application/json"),o.send(s))})}const te=U.getInstance();function Is(t,e){const i="Resolving display scenarios for "+(e?'custom event "'+e+'"':"pageview"),n=t.getCustomProperties(!0);te.log(p.info,i,n||void 0);const s={cid:Y,site:tt,ucrn:t.getUcrn(),url:document.location.toString(),pageviews:t.getPageViewCount(),v:t.getVisits().join(","),lv:1},o=t.getTestIp();o&&o.length&&(s.ip=o);const r=t.getAllRecommendations();Object.keys(r).forEach(f=>{s[`bandit[${f}]`]=r[f]});const a=t.getSource();a&&(s.src=a),e&&(s.e=e);const c=t.getKlaviyoExchangeId();c&&(s.kx=c);const d=t.getExternalSegments();d!==void 0&&(s.es=d),t.getPopupIds()&&t.getPopupIds().forEach(y=>{s["d["+y+"]"]=t.getLastDisplayedInterval(y),t.isConverted(y)&&(s["c["+y+"]"]=1),s["dc["+y+"]"]=t.getDisplayCount(y),t.isClosed(y)&&(s["cl["+y+"]"]=1)});const l=t.getSessionPopups();for(const f in l)l.hasOwnProperty(f)&&(s["ds["+f+"]"]=l[f]);const u=t.getSessionBars();for(const f in u)u.hasOwnProperty(f)&&(s["dbs["+f+"]"]=u[f]);s.skt=t.getSessionStickyTabs().join(","),t.hasAnySubscription()&&(s.sub=1);const h=t.getUtmParameters();for(const f in h)h.hasOwnProperty(f)&&(s["utm["+encodeURIComponent(f)+"]"]=h[f]);if(n)for(const f in n)n.hasOwnProperty(f)&&(s["p["+encodeURIComponent(f)+"]"]=n[f]);return s}function Es(t,e,i){if(t.status==="ok"){t.popups.length>0?te.log(p.info,"Matched popups: "+JSON.stringify(t.popups)):te.log(p.info,"No matching scenario");const n=Ft.knuthShuffle(t.popups.filter(o=>o.type!==F.STICKY)),s=t.popups.filter(o=>o.type===F.STICKY);if(s.sort((o,r)=>{const a=e.getPopup(parseInt(o.id,10)),c=e.getPopup(parseInt(r.id,10));if(!a||!c)return 1;const d=a.c&&typeof a.c=="number"?a.c+1e9:a.d,l=c.c&&typeof c.c=="number"?c.c+1e9:c.d;return d<l?1:-1}),n.push(...s),i){const o=n.map(({type:r})=>r);Wt(({details:{popupType:r,popupId:a}})=>ee(a)?n.some(({id:c})=>c===a)?!1:o.includes(r):!0)}else document.dispatchEvent(new CustomEvent("wisepops.internal",{detail:{action:"DESTROY_POPUP"}})),Wt(({details:{popupId:o}})=>ee(o)?!n.some(({id:r})=>r===o):!0);n.forEach(async({id:o,v:r,type:a,...c})=>{const d={...c,popupId:o,popupVersion:r,popupType:a};if(ee(d.popupId)||!ms(d)){us(d);const l=[];c.triggerClickAnchor&&l.push(zt(`[href$="${c.triggerClickAnchor}"]`)),c.selector&&l.push(zt(c.selector)),await Promise.all(l),te.log(p.info,"Loading popup: "+JSON.stringify(c)),c.campaignId&&!e.getRecommendationId(c.campaignId)&&e.setRecommendationId(c.campaignId,Number(c.id)),c.banditEventId&&e.setBanditEventId(c.id,c.banditEventId),c.banditId&&e.setBanditId(c.id,c.banditId),fs(d,c.hash??t.hashPath)}}),t.device!==void 0&&e.setDevice(t.device),t.location!==void 0&&e.setUserLocation(t.location),t.recaptcha_site_key&&e.setRecaptchaSiteKey(t.recaptcha_site_key),t.externalSegments!==void 0&&e.setExternalSegments(t.externalSegments),e.setTrafficChannel(t.traffic_channel||null),t.ip&&e.setUserIp(t.ip)}else if(t.status==="error")throw new Error(t.message||"An internal error occurred")}async function Kt(t,e){const i=Is(t,e);vs();try{Es(await bs(i),t,!!e)}catch(n){te.log(p.error,n)}}const Jt=U.getInstance(),m=Jt.log.bind(Jt),Ps=["string","number","boolean"];class ks{constructor(){this.pageviewCalled=!1,this.loggerDisplayLevel=null,this.storage=g.getInstance(),this.loggerDisplayLevel===null&&this.logAction(p.error)}defaultPageView(){!this.pageviewCalled&&this.storage.getAutoPageView()&&this.pageviewAction()}logAction(e){U.getInstance().displayAll(e)}eventAction(e){!e||typeof e!="string"?m(p.error,'Method "event" requires an event name as 2nd parameter'):(e.length>50&&(m(p.warn,"The event name cannot exceed 50 characters"),e=e.substr(0,50)),Kt(this.storage,e))}pageviewAction(){var i;const e=window[window.wisepops_key];this.storage.setArrivalOnPage(e.l),this.pageviewCalled||(this.storage.setArrivalOnSite(),this.storage.addVisit()),this.storage.incrementPageViewCount(this.pageviewCalled),this.storage.incrementSessionPagesElapsed(),(i=e._resetExitHandler)==null||i.call(e),Kt(this.storage),this.pageviewCalled=!0}goalAction(e,i=null){e&&typeof e!="string"?(m(p.error,'Method "goal" accepts a goal name as optional 2nd parameter'),e=null):e&&e.length>50&&(m(p.warn,"The goal name cannot exceed 50 characters"),e=e.substr(0,50)),typeof i=="string"&&(i=parseFloat(i)),i&&isNaN(i)&&(m(p.error,'Method "goal" accepts a revenue amount as optional 3rd parameter'),i=null),i&&i>1e6&&(m(p.warn,"The revenue cannot exceed 1,000,000"),i=1e6);let n="Tracking goal";e&&(n+=' named "'+e+'"'),i&&(n+=' with revenue "'+i+'"'),m(p.info,n);const s=this.storage.getLastDisplayedAndConvertedPopups();if(s.displayPopId||s.convertPopId){const o={e:"g"};e&&(o.n=e),i&&(o.r=i),s.displayPopId&&(o.pd=s.displayPopId,o.dd=s.displayDate.toJSON()),s.convertPopId&&(o.pc=s.convertPopId,o.dc=s.convertDate.toJSON()),Ie(o)}}propertiesAction(e,i){if(!e||!(e instanceof Object))m(p.error,'Method "properties" requires an object as 2nd parameter');else{const n=this.validateProperties(e,typeof i=="object"&&i.temporary);this.storage.setCustomProperties(n,i)}}optionsAction(e){Object.keys(e).map(i=>{switch(i){case"browserStorage":this.browserStorageOption(e[i]);return;case"cookieMaxSize":this.cookieMaxSizeOption(e[i]);return;case"cookieTTL":this.cookieTTLOption(e[i]);return;case"autoPageview":this.autoPageviewOption(e[i]);return;case"testIp":this.testIpOption(e[i]);return;default:m(p.error,`Unknown option "${i}"`)}})}dispatch([e,...i]){switch(m(p.debug,`Processing ${e} with`,i),e){case"listen":Fn(...i);break;default:const n=e+"Action";!e||!this[n]?m(p.error,'Unknown method "'+e+'"'):this[n](...i)}}validateProperties(e,i){const n={};for(const s in e)e.hasOwnProperty(s)&&(e[s]===null||e[s]===void 0||e[s]instanceof Object&&JSON.stringify(e[s])==="{}"?n[s]=null:this.isValidProperty(e[s])?s.length>50||!i&&e[s].toString().length>255?m(p.error,'Property "'+s+'" is too long'):e[s]instanceof Date?n[s]=e[s].toJSON():e[s]instanceof Object?n[s]=this.validateProperties(e[s],i):n[s]=e[s]:m(p.error,'Property "'+s+'" cannot be an instance of "'+typeof e[s]+'"'));return n}isValidProperty(e){return Ps.indexOf(typeof e)>-1||e instanceof Date||e instanceof Object&&!(e instanceof Array)}browserStorageOption(e){try{this.storage.setBrowserStorageUsed(!!e,!0)&&m(p.info,"Browser storage has been "+(e?"enabled":"disabled"))}catch(i){m(p.warn,i)}}cookieMaxSizeOption(e){e=Number(e),!Number.isInteger(e)||e<I.cookieMaxSizeMin||e>I.cookieMaxSizeMax?m(p.warn,"cookieMaxSize must be an integer between "+I.cookieMaxSizeMin+" and "+I.cookieMaxSizeMax):this.storage.isBrowserStorageUsed()?m(p.warn,"cookieMaxSize option is ignored when using browser storage"):(this.storage.setCookiesMaxSize(e),m(p.info,"Cookie max size set to "+e+"B"))}autoPageviewOption(e){typeof e!="boolean"&&m(p.warn,"autoPageview option must be a boolean value"),this.storage.setAutoPageView(e)}cookieTTLOption(e){e=Number(e),!Number.isInteger(e)||e<I.cookieTTLMin||e>I.cookieTTLMax?m(p.warn,"cookieTTL must be an integer between "+I.cookieTTLMin+" and "+I.cookieTTLMax):this.storage.isBrowserStorageUsed()?m(p.warn,"cookieTTL option is ignored when using browser storage"):(this.storage.setCookiesTTL(e),m(p.info,"Cookie TTL set to "+e+" days"))}testIpOption(e){e.length>6&&e.length<41?this.storage.setTestIp(e):m(p.error,`Invalid IP address provided "${e}"`)}}const ke=new ks,Yt=U.getInstance(),Oe=Yt.log.bind(Yt),K=g.getInstance(),Os=async t=>{var i;let e;try{e=window.self!==window.top&&!((i=window.Shopify)!=null&&i.designMode)}catch{e=!0}if(e){Oe(p.info,"Disabled inside iframe");return}else if(navigator.cookieEnabled){if(K.getDoNotDisplay()){Oe(p.info,"Disabled for 30 days");return}}else{Oe(p.error,"Cookies need to be enabled");return}An(),Ts(t),xs(t),window.__WISEPOPS_TESTS__&&Ds(t,ke),Cs(t),$n(t)};function Ts(t){Object.keys(A).forEach(e=>{t[e]=A[e]}),window.__WISEPOPS_ALLOW_DEBUG__&&(t._getDebugData=()=>K.getDebugData())}function Ds(t,e){t.__tests__={storage:K,api:e}}function Cs(t){const e=i=>{if(typeof i=="function")try{i(t)}catch(n){Oe(p.error,"LoaderCallback - "+n)}};e(window.WisePopsLoaderCallback),Object.defineProperty(window,"WisePopsLoaderCallback",{set:e})}function xs(t){t.isPreviewMode=window.__WISEPOPS_PREVIEW_MODE__,t._api={trackSignup:t._trackSignup,trackDisplay:t._trackDisplay,trackClick:t._trackClick,log:t._log,registerBackExitTrigger:t._registerBackExitTrigger},t._storage={isConverted:t._isConverted,getPageViewCount:t._getPageViewCount,getArrivalOnPage:t._getArrivalOnPage,getUserLocation:t._getUserLocation,getTafficChannel:t._getTrafficChannel,getUserIp:t._getUserIp,getSource:t._getSource,getSourceDomain:t._getSourceDomain,getUTMParameters:t._getUTMParameters,isPhoneDevice:t._isPhoneDevice,isTabletDevice:t._isTabletDevice,setDoNotDisplay:t._setDoNotDisplay,getDoNotDisplay:t._getDoNotDisplay},window.wiseStorage={isConverted(e){return K.isConverted(e)},setConverted(e){return K.setConverted(e)},setDisplayed(e,i){return K.setDisplayed(e,i)},_getObj(){return window[window.wisepops_key]}},window.WisepopsAddToCookiePage=()=>{}}const Ns=()=>{const t=document.createElement("script");t.async=!0,t.src=`${Ne}/toolbelt.js?h=${L}`,document.head.appendChild(t)},Rs="wisepops-setup",As=window.requestIdleCallback??setTimeout,Ls=()=>new URLSearchParams(document.location.search).get(Rs)!==null,$s=()=>{As(()=>{Ls()&&Ns()})},Us=()=>{var e,i;return!(window.ShopifyAnalytics!==void 0)||!Qe.includes("RECOMMENDATIONS_FEED")?{}:{product:(i=(e=window.ShopifyAnalytics)==null?void 0:e.meta)!=null&&i.product?window.location.pathname.split("/").pop():void 0}},Ms=()=>({...Us()});let Te;try{Te=JSON.parse(atob(ai))}catch{console.error("Failed to parse Wisepops goals"),Te=[]}const Bs=t=>{const e=Te.filter(({type:i})=>i==="URL");for(const i of e)if(t.includes(i.trackUrl))return i;return null},Fs=t=>{t.q=t.q||[];const e=t.q.push;t.q.push=i=>t.q.length>0?e.apply(t.q,[i]):(Xt(i),0)},js=t=>{const e=t.q;e.forEach(i=>{Xt(i)}),e.length=0},Xt=t=>{if(t.length===0)return;const[e,...i]=Array.from(t);if(typeof e=="string")switch(e){case"goal":Vs(...i);break;default:ke.dispatch([e,...i])}},Vs=(...t)=>{const e=t[0]??null,i=t[1]??null,n=Te.find(({hash:o})=>o===e);if(n===void 0){ke.goalAction(e,typeof i=="number"||typeof i=="string"?i:null);return}let s;typeof i=="object"&&i!==null&&"revenue"in i&&typeof i.revenue=="number"&&(s=i.revenue*100),v(S.CONVERSION,{goalId:n.hash,revenueCents:s})},Hs=(t,e=300)=>{let i;return(...n)=>{clearTimeout(i),i=setTimeout(()=>t(...n),e)}},Gs=t=>{let e=window.location.hostname+window.location.pathname;new MutationObserver(()=>{const i=window.location.hostname+window.location.pathname;e!==i&&(e=i,t())}).observe(document,{childList:!0,subtree:!0})},Zt=async()=>{if(Qe.includes("VISITOR_ID")){const e=Ms();await Si(e)}else pi();v(S.PAGEVIEW,{title:document.title});const t=Bs(window.location.href);t&&v(S.CONVERSION,{goalId:t.hash,revenueCents:t.attributeRevenue??void 0})},qs=async()=>{window.wisepops_key=window.WisePopsObject=window.wisepops_key||window.WisePopsObject||"wisepops";const t=window[window.wisepops_key];Fs(t),await Zt(),await Os(t),Ii(),Dn(),$s(),Gs(Hs(Zt)),js(t),ke.defaultPageView()};(window.wisepops_started??!1)||(window.wisepops_started=!0,qs().catch(t=>{console.error(t)}))})();
